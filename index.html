<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <title>H·ªá th·ªëng √în thi K76.A03 - C√≥ L·ªãch s·ª≠</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <style>
        :root { 
            --primary: #2c3e50; --secondary: #27ae60; --danger: #e74c3c; 
            --accent: #2980b9; --light: #f4f7f6; --shadow: 0 10px 30px rgba(0,0,0,0.2);
        }
        body { font-family: 'Segoe UI', Arial, sans-serif; margin: 0; padding: 0; color: #1a1a1a; font-size: 18px; background-color: var(--light); }
        .container { max-width: 1000px; margin: 30px auto; background: white; padding: 30px; border-radius: 25px; box-shadow: var(--shadow); min-height: 80vh; }
        
        header { text-align: center; margin-bottom: 30px; border-bottom: 3px solid var(--primary); padding-bottom: 15px; }
        header h1 { color: var(--primary); margin: 0; font-size: 28px; }

        nav { display: flex; gap: 12px; margin-bottom: 25px; flex-wrap: wrap; justify-content: center; }
        button { padding: 12px 25px; border: none; border-radius: 12px; cursor: pointer; font-weight: bold; font-size: 16px; transition: 0.1s; box-shadow: 0 5px #7f8c8d; position: relative; outline: none; }
        button:active { box-shadow: 0 0 #7f8c8d; transform: translateY(5px); }
        
        .btn-main { background: var(--primary); color: white; box-shadow: 0 5px #1a252f; }
        .btn-orange { background: #d35400; color: white; box-shadow: 0 5px #a04000; }
        .btn-green { background: var(--secondary); color: white; box-shadow: 0 5px #196f3d; }
        .btn-purple { background: #8e44ad; color: white; box-shadow: 0 5px #6c3483; }

        .q-block { border: 1px solid #cfd8dc; padding: 25px; margin: 15px 0; border-radius: 15px; background: #fff; }
        .q-block p { font-weight: bold; font-size: 21px; color: #0d47a1; margin-top: 0; line-height: 1.5; }
        
        .tf-group { display: flex; gap: 60px; margin-top: 15px; }
        .option-item { display: flex; align-items: center; cursor: pointer; font-size: 20px; font-weight: bold; }
        input[type="radio"] { width: 28px; height: 28px; margin-right: 12px; cursor: pointer; }
        
        .wrong-ans { border-left: 10px solid var(--danger) !important; background: #ffebee !important; }
        .result-header { background: #fff9c4; border: 4px solid #fbc02d; padding: 25px; margin-bottom: 25px; border-radius: 15px; text-align: center; display: none; }
        
        table { width: 100%; border-collapse: collapse; margin-top: 20px; background: #fff; border-radius: 10px; overflow: hidden; }
        th, td { padding: 15px; text-align: left; border-bottom: 1px solid #ddd; }
        th { background: #f8f9fa; color: var(--primary); }

        .hidden { display: none !important; }
    </style>
</head>
<body>

<div class="container">
    <header>
        <h1>H·ªá th·ªëng √în thi VƒÉn ho√° Ph√°t tri·ªÉn</h1>
        <p style="color:var(--accent); font-weight:bold;">K76.A03 - Ch·∫ø ƒë·ªô Guest</p>
    </header>

    <div id="sync-info" style="text-align:center; color: #e67e22; font-weight:bold; margin-bottom:10px;">‚è≥ ƒêang t·∫£i d·ªØ li·ªáu t·ª´ Google Sheets...</div>

    <nav id="main-nav" class="hidden">
        <button class="btn-main" onclick="startQuiz(10)">üé≤ THI 10 C√ÇU</button>
        <button class="btn-orange" onclick="startQuiz(20)">üî• THI 20 C√ÇU</button>
        <button class="btn-green" onclick="renderViewAll()">üìö XEM ƒê√ÅP √ÅN</button>
        <button class="btn-purple" onclick="renderHistory()">üìú L·ªäCH S·ª¨ THI</button>
    </nav>

    <div id="top-result" class="result-header">
        <div id="score-text"></div>
        <button class="btn-main" onclick="resetApp()">L√ÄM ƒê·ªÄ KH√ÅC</button>
    </div>

    <div id="app-area"></div>
    <button class="btn-green hidden" id="submit-btn" style="width:100%; font-size:24px; padding:20px; border-radius:15px; margin-top:20px" onclick="submitQuiz()">N·ªòP B√ÄI KI·ªÇM TRA</button>
</div>

<script>
const SHEET_URL = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vQ0PBaO37SuC5N0NbCMHlN5qY8AvvpKtYbv7pWTpjgjdPvOkBMWZLcvLCX-B0U6zdgCy0rYPIWoZB64/pub?output=csv';

let App = {
    db: [],
    currentQs: [],
    history: JSON.parse(localStorage.getItem('vhpt_guest_history')) || [],
    currentType: ''
};

window.onload = async () => { await syncData(); };

async function syncData() {
    try {
        const res = await fetch(SHEET_URL);
        const csv = await res.text();
        const workbook = XLSX.read(csv, {type:'string'});
        const data = XLSX.utils.sheet_to_json(workbook.Sheets[workbook.SheetNames[0]]);
        
        App.db = data.map(r => {
            const getVal = (k) => r[Object.keys(r).find(x => x.trim() === k)] || '';
            let correctAns = "ƒê√∫ng";
            if (getVal('Sai').toString().toLowerCase() === 'x') correctAns = "Sai";
            return { content: getVal('N·ªôi dung'), ans: correctAns };
        }).filter(x => x.content);

        document.getElementById('sync-info').innerHTML = `‚úÖ S·∫µn s√†ng √¥n t·∫≠p v·ªõi ${App.db.length} c√¢u h·ªèi!`;
        document.getElementById('main-nav').classList.remove('hidden');
    } catch (e) {
        document.getElementById('sync-info').innerHTML = `‚ùå L·ªói t·∫£i d·ªØ li·ªáu. H√£y ki·ªÉm tra k·∫øt n·ªëi!`;
    }
}

function startQuiz(count) {
    App.currentType = `Thi ${count} c√¢u`;
    document.getElementById('top-result').style.display = 'none';
    App.currentQs = [...App.db].sort(() => 0.5 - Math.random()).slice(0, count);
    renderQuiz();
}

function renderQuiz() {
    document.getElementById('submit-btn').classList.remove('hidden');
    const area = document.getElementById('app-area');
    area.innerHTML = App.currentQs.map((q, i) => `
        <div class="q-block" id="wrap-${i}">
            <p>${i+1}. ${q.content}</p>
            <div class="tf-group">
                <label class="option-item"><input type="radio" name="q${i}" value="ƒê√∫ng"> ƒê√∫ng</label>
                <label class="option-item"><input type="radio" name="q${i}" value="Sai"> Sai</label>
            </div>
        </div>
    `).join('');
    window.scrollTo({top: 0, behavior: 'smooth'});
}

function submitQuiz() {
    let score = 0;
    App.currentQs.forEach((q, i) => {
        const selected = document.querySelector(`input[name="q${i}"]:checked`);
        const wrap = document.getElementById(`wrap-${i}`);
        if (selected && selected.value === q.ans) score++;
        else {
            wrap.classList.add('wrong-ans');
            wrap.innerHTML += `<div style="color:var(--danger); font-weight:bold; margin-top:10px;">üëâ ƒê√ÅP √ÅN ƒê√öNG: ${q.ans.toUpperCase()}</div>`;
        }
    });

    // L∆∞u l·ªãch s·ª≠
    const result = {
        date: new Date().toLocaleString(),
        type: App.currentType,
        score: `${score}/${App.currentQs.length}`
    };
    App.history.push(result);
    localStorage.setItem('vhpt_guest_history', JSON.stringify(App.history));

    document.getElementById('score-text').innerHTML = `<h2>K·∫æT QU·∫¢: ${score} / ${App.currentQs.length}</h2>`;
    document.getElementById('top-result').style.display = 'block';
    document.getElementById('submit-btn').classList.add('hidden');
    window.scrollTo({top: 0, behavior: 'smooth'});
}

function renderHistory() {
    document.getElementById('top-result').style.display = 'none';
    document.getElementById('submit-btn').classList.add('hidden');
    const area = document.getElementById('app-area');
    
    if (App.history.length === 0) {
        area.innerHTML = "<p style='text-align:center;'>B·∫°n ch∆∞a c√≥ l·ªãch s·ª≠ thi n√†o.</p>";
        return;
    }

    let html = `<h3>üìú L·ªäCH S·ª¨ THI G·∫¶N ƒê√ÇY</h3><table><tr><th>Th·ªùi gian</th><th>Lo·∫°i b√†i</th><th>K·∫øt qu·∫£</th></tr>`;
    App.history.slice().reverse().forEach(h => {
        html += `<tr><td>${h.date}</td><td>${h.type}</td><td style="color:var(--secondary); font-weight:bold;">${h.score}</td></tr>`;
    });
    html += `</table><button class="btn-orange" style="margin-top:20px; width:100%;" onclick="clearHistory()">X√ìA L·ªäCH S·ª¨</button>`;
    area.innerHTML = html;
}

function clearHistory() {
    if (confirm("B·∫°n c√≥ ch·∫Øc mu·ªën x√≥a to√†n b·ªô l·ªãch s·ª≠ kh√¥ng?")) {
        App.history = [];
        localStorage.removeItem('vhpt_guest_history');
        renderHistory();
    }
}

function renderViewAll() {
    document.getElementById('top-result').style.display = 'none';
    document.getElementById('submit-btn').classList.add('hidden');
    document.getElementById('app-area').innerHTML = `<h2 style="text-align:center;">DANH S√ÅCH ƒê√ÅP √ÅN</h2>` + 
    App.db.map((q, i) => `<div class="q-block"><p>${i+1}. ${q.content}</p><b style="color:${q.ans==='ƒê√∫ng'?'green':'red'}">=> ${q.ans.toUpperCase()}</b></div>`).join('');
}

function resetApp() { document.getElementById('top-result').style.display = 'none'; document.getElementById('app-area').innerHTML = ''; }
</script>
</body>
</html>
