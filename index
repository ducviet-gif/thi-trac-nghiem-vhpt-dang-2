<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <title>H·ªá th·ªëng K76.A03 - D·∫°ng ƒê√∫ng/Sai</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <style>
        :root { 
            --primary: #2c3e50; --secondary: #27ae60; --danger: #e74c3c; 
            --accent: #2980b9; --light: #f4f7f6; --shadow: 0 10px 30px rgba(0,0,0,0.3);
        }
        body { font-family: 'Segoe UI', Arial, sans-serif; margin: 0; padding: 0; color: #1a1a1a; font-size: 18px; background-color: var(--light); }
        
        /* Giao di·ªán Login 3D */
        #auth-page { 
            height: 100vh; width: 100%; display: flex; align-items: center; justify-content: center;
            background: linear-gradient(rgba(0,0,0,0.7), rgba(0,0,0,0.7)), url('https://images.unsplash.com/photo-1507842217343-583bb7270b66?auto=format&fit=crop&w=1920&q=80');
            background-size: cover; background-position: center; position: fixed; top: 0; left: 0; z-index: 9999;
        }
        .auth-box { background: rgba(255, 255, 255, 0.98); padding: 40px; border-radius: 25px; width: 450px; box-shadow: var(--shadow); text-align: center; border: 1px solid white; }
        .auth-box h1 { font-size: 26px; color: var(--primary); margin-bottom: 5px; }
        
        .container { max-width: 1200px; margin: 20px auto; background: white; padding: 30px; border-radius: 25px; box-shadow: var(--shadow); }
        
        nav { display: flex; gap: 10px; margin-bottom: 20px; flex-wrap: wrap; justify-content: center; }
        button { padding: 12px 20px; border: none; border-radius: 12px; cursor: pointer; font-weight: bold; font-size: 16px; transition: 0.1s; box-shadow: 0 5px #7f8c8d; position: relative; outline: none; }
        button:active { box-shadow: 0 0 #7f8c8d; transform: translateY(5px); }
        .btn-main { background: var(--primary); color: white; box-shadow: 0 5px #1a252f; }
        .btn-green { background: var(--secondary); color: white; box-shadow: 0 5px #196f3d; }
        .btn-orange { background: #d35400; color: white; box-shadow: 0 5px #a04000; }
        .btn-sub { background: var(--accent); color: white; box-shadow: 0 5px #1a5276; }

        .q-block { border: 1px solid #cfd8dc; padding: 25px; margin: 15px 0; border-radius: 15px; background: #fff; transition: 0.3s; }
        .q-block p { font-weight: bold; font-size: 22px; color: #0d47a1; margin-top: 0; line-height: 1.4; }
        
        .tf-group { display: flex; gap: 50px; margin-top: 15px; }
        .option-item { display: flex; align-items: center; cursor: pointer; font-size: 20px; font-weight: bold; padding: 10px 20px; border-radius: 10px; }
        .option-item:hover { background: #f0f7ff; }
        input[type="radio"] { width: 30px; height: 30px; margin-right: 15px; cursor: pointer; }
        
        .wrong-ans { border-left: 10px solid #c62828 !important; background: #ffebee !important; }
        .result-header { background: #fff9c4; border: 4px solid #fbc02d; padding: 20px; margin-bottom: 20px; border-radius: 15px; text-align: center; display: none; }
        .hidden { display: none !important; }
        input[type="text"], input[type="password"] { width:100%; padding:15px; margin-bottom:15px; border-radius:10px; border:1px solid #ccc; font-size:18px; box-sizing: border-box; }
    </style>
</head>
<body>

<div id="auth-page">
    <div class="auth-box">
        <h1>H·ªá th·ªëng √în thi VHPT</h1>
        <h2 style="color:var(--accent)">D·∫°ng ƒê√∫ng/Sai - Phi√™n b·∫£n Online</h2>
        
        <div id="login-section">
            <input type="text" id="user-name" placeholder="T√™n t√†i kho·∫£n">
            <input type="password" id="user-pass" placeholder="M·∫≠t kh·∫©u">
            <button class="btn-main" style="width:100%;" onclick="handleLogin()">ƒêƒÇNG NH·∫¨P</button>
            <button class="btn-green" style="width:100%; margin-top:12px;" onclick="handleGuest()">V√ÄO NHANH (GUEST)</button>
            <p style="margin-top:20px;">Ch∆∞a c√≥ t√†i kho·∫£n? <a href="javascript:void(0)" onclick="showReg()">ƒêƒÉng k√Ω</a></p>
        </div>

        <div id="reg-section" class="hidden">
            <h3 style="color:var(--secondary)">ƒêƒÇNG K√ù</h3>
            <input type="text" id="reg-name" placeholder="T√™n ƒëƒÉng nh·∫≠p">
            <input type="password" id="reg-pass" placeholder="M·∫≠t kh·∫©u">
            <button class="btn-sub" style="width:100%;" onclick="handleRegister()">X√ÅC NH·∫¨N</button>
            <p style="margin-top:20px;"><a href="javascript:void(0)" onclick="showLogin()">Quay l·∫°i</a></p>
        </div>
    </div>
</div>

<div id="main-app" class="hidden">
    <div class="container">
        <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:15px;">
            <div id="welcome-msg" style="font-weight:bold; color:var(--secondary); font-size:20px;"></div>
            <div id="sync-info" style="font-size:14px; color:#e67e22; font-weight:bold;">ƒêang t·∫£i d·ªØ li·ªáu...</div>
            <button onclick="location.reload()" style="background:#999; color:white; padding:5px 15px; font-size:14px; box-shadow:none;">ƒêƒÉng xu·∫•t</button>
        </div>

        <nav>
            <button class="btn-main" onclick="startQuiz(10)">üé≤ THI 10 C√ÇU</button>
            <button class="btn-orange" onclick="startQuiz(20)">üî• THI 20 C√ÇU</button>
            <button class="btn-green" onclick="renderViewAll()">üìö XEM ƒê√ÅP √ÅN</button>
            <button class="btn-sub" onclick="renderHistory()">üìú L·ªäCH S·ª¨</button>
        </nav>

        <div id="top-result" class="result-header">
            <div id="score-text"></div>
            <button class="btn-sub" onclick="location.reload()">L√ÄM ƒê·ªÄ KH√ÅC</button>
        </div>

        <div id="app-area"></div>
        <button class="btn-main hidden" id="submit-btn" style="width:100%; font-size:24px; padding:20px; border-radius:15px; margin-top:20px" onclick="submitQuiz()">N·ªòP B√ÄI KI·ªÇM TRA</button>
    </div>
</div>

<script>
// --- C·∫§U H√åNH ƒê∆Ø·ªúNG D·∫™N ---
const SHEET_URL = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vQ0PBaO37SuC5N0NbCMHlN5qY8AvvpKtYbv7pWTpjgjdPvOkBMWZLcvLCX-B0U6zdgCy0rYPIWoZB64/pub?output=csv'; 

let App = {
    users: JSON.parse(localStorage.getItem('k76_users_ds')) || {},
    session: null,
    db: [],
    currentQs: []
};

// --- SYNC DATA ---
async function syncData() {
    try {
        const res = await fetch(SHEET_URL);
        const csv = await res.text();
        const workbook = XLSX.read(csv, {type:'string'});
        const data = XLSX.utils.sheet_to_json(workbook.Sheets[workbook.SheetNames[0]]);
        
        App.db = data.map(r => {
            const getVal = (k) => r[Object.keys(r).find(x => x.trim() === k)] || '';
            // Logic: N·∫øu c·ªôt 'ƒê√∫ng' c√≥ x th√¨ ans=ƒê√∫ng, n·∫øu c·ªôt 'Sai' c√≥ x th√¨ ans=Sai 
            let correct = "ƒê√∫ng";
            if (getVal('Sai').toString().toLowerCase() === 'x') correct = "Sai";
            
            return { q: getVal('N·ªôi dung'), ans: correct };
        }).filter(x => x.q);

        document.getElementById('sync-info').innerText = `‚úÖ ƒê√£ t·∫£i ${App.db.length} c√¢u h·ªèi online`;
    } catch (e) {
        document.getElementById('sync-info').innerText = `‚ö†Ô∏è L·ªói t·∫£i Drive - Ki·ªÉm tra link CSV!`;
    }
}

window.onload = syncData;

// --- AUTH ---
function showReg() { document.getElementById('login-section').classList.add('hidden'); document.getElementById('reg-section').classList.remove('hidden'); }
function showLogin() { document.getElementById('login-section').classList.remove('hidden'); document.getElementById('reg-section').classList.add('hidden'); }
function handleRegister() {
    const n = document.getElementById('reg-name').value.trim();
    const p = document.getElementById('reg-pass').value.trim();
    if(!n || !p) return alert("ƒêi·ªÅn ƒë·ªß th√¥ng tin!");
    App.users[n] = { pass: p, history: [] };
    localStorage.setItem('k76_users_ds', JSON.stringify(App.users));
    alert("ƒê√£ ƒëƒÉng k√Ω!"); showLogin();
}
function handleLogin() {
    const n = document.getElementById('user-name').value.trim();
    const p = document.getElementById('user-pass').value.trim();
    if(App.users[n] && App.users[n].pass === p) launchApp(n);
    else alert("Sai t√†i kho·∫£n!");
}
function handleGuest() { launchApp("Kh√°ch_" + Math.floor(Math.random()*999)); }
function launchApp(name) {
    App.session = name;
    if(!App.users[name]) App.users[name] = { history: [] };
    document.getElementById('auth-page').classList.add('hidden');
    document.getElementById('main-app').classList.remove('hidden');
    document.getElementById('welcome-msg').innerText = "Ch√†o: " + name;
}

// --- QUIZ ---
function startQuiz(count) {
    if(App.db.length === 0) return alert("D·ªØ li·ªáu ch∆∞a t·∫£i xong ho·∫∑c l·ªói link!");
    document.getElementById('top-result').style.display = 'none';
    App.currentQs = [...App.db].sort(() => 0.5 - Math.random()).slice(0, count);
    
    document.getElementById('submit-btn').classList.remove('hidden');
    document.getElementById('app-area').innerHTML = App.currentQs.map((q, i) => `
        <div class="q-block" id="wrap-${i}">
            <p>${i+1}. ${q.q}</p>
            <div class="tf-group">
                <label class="option-item"><input type="radio" name="q${i}" value="ƒê√∫ng"> ƒê√∫ng</label>
                <label class="option-item"><input type="radio" name="q${i}" value="Sai"> Sai</label>
            </div>
        </div>
    `).join('');
    window.scrollTo({top: 0, behavior: 'smooth'});
}

function submitQuiz() {
    let score = 0;
    App.currentQs.forEach((q, i) => {
        const sel = document.querySelector(`input[name="q${i}"]:checked`);
        const wrap = document.getElementById(`wrap-${i}`);
        if(sel && sel.value === q.ans) score++;
        else {
            wrap.classList.add('wrong-ans');
            wrap.innerHTML += `<div style="color:var(--danger); font-weight:bold; margin-top:10px;">=> ƒê√ÅP √ÅN ƒê√öNG: ${q.ans.toUpperCase()}</div>`;
        }
    });

    App.users[App.session].history.push({ date: new Date().toLocaleString(), score: `${score}/${App.currentQs.length}` });
    localStorage.setItem('k76_users_ds', JSON.stringify(App.users));

    document.getElementById('score-text').innerHTML = `<h2>K·∫æT QU·∫¢: ${score} / ${App.currentQs.length}</h2>`;
    document.getElementById('top-result').style.display = 'block';
    document.getElementById('submit-btn').classList.add('hidden');
    window.scrollTo({top: 0, behavior: 'smooth'});
}

function renderViewAll() {
    document.getElementById('submit-btn').classList.add('hidden');
    document.getElementById('app-area').innerHTML = App.db.map((q, i) => `
        <div class="q-block">
            <p>${i+1}. ${q.q}</p>
            <b style="color:${q.ans==='ƒê√∫ng'?'green':'red'}">=> ƒê√ÅP √ÅN: ${q.ans.toUpperCase()}</b>
        </div>`).join('');
}

function renderHistory() {
    const hist = App.users[App.session]?.history || [];
    document.getElementById('app-area').innerHTML = `<h3>L·ªäCH S·ª¨</h3>` + hist.slice().reverse().map(h => `<div class='q-block'>Ng√†y: ${h.date} - ƒêi·ªÉm: <b>${h.score}</b></div>`).join('');
}
</script>
</body>
</html>
